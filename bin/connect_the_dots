#!/bin/bash
#
# Filename:    connect_the_dots
# Description: Softly link all *nix configuration files.
#

set -e

#
# Dependencies
#
if [ -f ~/dotfiles/lib/lib.bash ]; then
    echo "Dependencies found. Proceeding..."
    . ~/dotfiles/lib/lib.bash
else
    echo "Error: could not find dependent script(s)."
    exit 1
fi

#
# Variables
#
DOTFILES="$HOME/dotfiles"
LNFLAGS=''

#
# Script
#
echo_red "Screening directory..."

# Check for ~/bin
[ ! -d ~/bin ] &&
    echo_red "Error: ~/bin not found.\nCreating..." &&
    mkdir ~/bin &&
    echo_green "Done."

echo_green "Done."

# Specific Nix
echo_red "`uname -s` kernel detected.\nLinking files specific to system..."

if [[ `uname -s` == 'Darwin' ]]; then
    LNFLAGS="-shfv"
elif [[ `uname -s` == 'Linux' ]]; then
    LNFLAGS="-sTfv"
    dot_connect $LNFLAGS "redshift*" ~/.config
fi

echo_green "Done."

# Shared Nix
echo_red "Linking shared *nix files..."

dot_connect $LNFLAGS $DOTFILES/"bash*"    ~         dot
dot_connect $LNFLAGS $DOTFILES/"emacs.d"  ~         dot
dot_connect $LNFLAGS $DOTFILES/"rgignore" ~/.config dot
dot_connect $LNFLAGS $DOTFILES/"tmux*"    ~         dot

echo_green "Done.\nAll dotfiles linked. Have a nice day."
