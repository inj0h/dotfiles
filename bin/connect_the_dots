#!/bin/bash
#
# Filename:    connect_the_dots
# Description: Softly link all *nix configuration files.
#

set -e

#
# Dependencies
#
if [ -f $HOME/dotfiles/bash.d/lib.bash ]; then
    echo "Dependencies found. Proceeding..."
    source $HOME/dotfiles/bash.d/lib.bash
else
    echo "Error: could not find dependent script(s)."
    exit 1
fi

#
# Variables
#
DOTFILES="$HOME/dotfiles/"
LNFLAGS=''

#
# Script
#
print_red "Screening directory..."

# Check for cloned repo
if [ ! -d $HOME/dotfiles ]; then
    print_red "Error: dotfiles not found.\nAborting..."

    exit 1
fi

# Check for ~/bin
if [ ! -d $HOME/bin ]; then
    print_red "Error: ~/bin not found.\nCreating..."

    mkdir $HOME/bin

    print_green "Done."
fi

print_green "Done."

# Specific Nix
print_red "`uname -s` kernel detected.\nLinking files specific to system..."

if [[ `uname -s` == 'Darwin' ]]; then
    LNFLAGS="-shfv"

elif [[ `uname -s` == 'Linux' ]]; then
    LNFLAGS="-sTfv"

    link $LNFLAGS "X*" $HOME dot
    link $LNFLAGS "redshift*" $HOME/.config
fi

print_green "Done."

# Shared Nix
print_red "Linking shared *nix files..."

dot_connect $LNFLAGS $DOTFILES"bash*" $HOME dot
dot_connect $LNFLAGS $DOTFILES"bin/*" $HOME/bin
dot_connect $LNFLAGS $DOTFILES"emacs.d" $HOME dot
dot_connect $LNFLAGS $DOTFILES"rgignore" $HOME/.config dot
dot_connect $LNFLAGS $DOTFILES"tmux*" $HOME dot

print_green "Done.\nAll dotfiles linked. Have a nice day."
